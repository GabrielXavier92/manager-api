# Migration `20200525182525-init`

This migration has been generated by Gabriel Xavier at 5/25/2020, 6:25:25 PM.
You can check out the [state of the schema](./schema.prisma) after the migration.

## Database Steps

```sql
CREATE TYPE "Plan" AS ENUM ('STARTER');

CREATE TYPE "Gender" AS ENUM ('MASCULINO', 'FEMININO');

CREATE TABLE "public"."Account" (
"createdAt" timestamp(3)  NOT NULL DEFAULT CURRENT_TIMESTAMP,"id" text  NOT NULL ,"name" text  NOT NULL ,"plan" "Plan" NOT NULL DEFAULT 'STARTER',"status" boolean  NOT NULL DEFAULT true,"updatedAt" timestamp(3)  NOT NULL ,
    PRIMARY KEY ("id"))

CREATE TABLE "public"."User" (
"accountId" text  NOT NULL ,"createdAt" timestamp(3)  NOT NULL DEFAULT CURRENT_TIMESTAMP,"doctorId" text   ,"email" text  NOT NULL ,"gender" "Gender"  ,"id" text  NOT NULL ,"name" text  NOT NULL ,"password" text  NOT NULL ,"status" boolean  NOT NULL DEFAULT true,"updatedAt" timestamp(3)  NOT NULL ,
    PRIMARY KEY ("id"))

CREATE TABLE "public"."Roles" (
"id" text  NOT NULL ,"role" text  NOT NULL ,
    PRIMARY KEY ("id"))

CREATE TABLE "public"."Doctor" (
"accountId" text  NOT NULL ,"birth" timestamp(3)   ,"createdAt" timestamp(3)  NOT NULL DEFAULT CURRENT_TIMESTAMP,"gender" "Gender"  ,"id" text  NOT NULL ,"name" text  NOT NULL ,"register" text   ,"updatedAt" timestamp(3)  NOT NULL ,
    PRIMARY KEY ("id"))

CREATE TABLE "public"."Patient" (
"accountId" text  NOT NULL ,"birth" timestamp(3)   ,"createdAt" timestamp(3)  NOT NULL DEFAULT CURRENT_TIMESTAMP,"gender" "Gender"  ,"id" text  NOT NULL ,"name" text  NOT NULL ,"updatedAt" timestamp(3)  NOT NULL ,
    PRIMARY KEY ("id"))

CREATE TABLE "public"."Guide" (
"accountId" text  NOT NULL ,"createdAt" timestamp(3)  NOT NULL DEFAULT CURRENT_TIMESTAMP,"description" text  NOT NULL ,"doctorId" text  NOT NULL ,"id" text  NOT NULL ,"patientId" text  NOT NULL ,"updatedAt" timestamp(3)  NOT NULL ,
    PRIMARY KEY ("id"))

CREATE TABLE "public"."_RolesToUser" (
"A" text  NOT NULL ,"B" text  NOT NULL )

CREATE UNIQUE INDEX "User.email" ON "public"."User"("email")

CREATE UNIQUE INDEX "User_doctorId" ON "public"."User"("doctorId")

CREATE UNIQUE INDEX "Roles.role" ON "public"."Roles"("role")

CREATE UNIQUE INDEX "_RolesToUser_AB_unique" ON "public"."_RolesToUser"("A","B")

CREATE  INDEX "_RolesToUser_B_index" ON "public"."_RolesToUser"("B")

ALTER TABLE "public"."User" ADD FOREIGN KEY ("accountId")REFERENCES "public"."Account"("id") ON DELETE CASCADE  ON UPDATE CASCADE

ALTER TABLE "public"."User" ADD FOREIGN KEY ("doctorId")REFERENCES "public"."Doctor"("id") ON DELETE SET NULL  ON UPDATE CASCADE

ALTER TABLE "public"."Doctor" ADD FOREIGN KEY ("accountId")REFERENCES "public"."Account"("id") ON DELETE CASCADE  ON UPDATE CASCADE

ALTER TABLE "public"."Patient" ADD FOREIGN KEY ("accountId")REFERENCES "public"."Account"("id") ON DELETE CASCADE  ON UPDATE CASCADE

ALTER TABLE "public"."Guide" ADD FOREIGN KEY ("accountId")REFERENCES "public"."Account"("id") ON DELETE CASCADE  ON UPDATE CASCADE

ALTER TABLE "public"."Guide" ADD FOREIGN KEY ("doctorId")REFERENCES "public"."Doctor"("id") ON DELETE CASCADE  ON UPDATE CASCADE

ALTER TABLE "public"."Guide" ADD FOREIGN KEY ("patientId")REFERENCES "public"."Patient"("id") ON DELETE CASCADE  ON UPDATE CASCADE

ALTER TABLE "public"."_RolesToUser" ADD FOREIGN KEY ("A")REFERENCES "public"."Roles"("id") ON DELETE CASCADE  ON UPDATE CASCADE

ALTER TABLE "public"."_RolesToUser" ADD FOREIGN KEY ("B")REFERENCES "public"."User"("id") ON DELETE CASCADE  ON UPDATE CASCADE
```

## Changes

```diff
diff --git schema.prisma schema.prisma
migration ..20200525182525-init
--- datamodel.dml
+++ datamodel.dml
@@ -1,0 +1,92 @@
+// This is your Prisma schema file,
+// learn more about it in the docs: https://pris.ly/d/prisma-schema
+
+datasource db {
+  provider = "postgresql"
+  url      = env("DATABASE_URL")
+}
+
+generator client {
+  provider = "prisma-client-js"
+}
+
+enum Plan {
+  STARTER
+}
+
+
+model Account {
+  id String          @id @default(uuid())
+  plan Plan @default(STARTER)
+  status Boolean  @default(true)
+  name String
+  users User[]
+  createdAt DateTime @default(now())
+  updatedAt DateTime @updatedAt
+}
+
+enum Gender {
+  MASCULINO
+  FEMININO
+}
+
+model User {
+  id String          @id @default(uuid())
+  account Account @relation(fields: [accountId], references: [id]) // Relacionamento com a conta
+  accountId String // Relacionamento com a conta
+  status Boolean @default(true)
+  email String @unique
+  password String
+  name String
+  gender Gender? // Enum
+  roles Roles[] @relation(references: [id])  // Relacionamento com as roles
+  doctor Doctor?  @relation(fields: [doctorId], references: [id]) // Relacionamento com um Doctor caso exista
+  doctorId String? // Relacionamento com um Doctor caso exista
+  createdAt DateTime @default(now())
+  updatedAt DateTime @updatedAt
+}
+
+model Roles {
+  id String @id @default(uuid())
+  role String @unique
+  users User[] @relation(references: [id])
+}
+
+model Doctor {
+  id String          @id @default(uuid())
+  account Account @relation(fields: [accountId], references: [id]) // Relacionamento com a conta
+  accountId String // Relacionamento com a conta
+  user User? // Relacionamento com um User caso exista
+  name String
+  gender Gender? // Enum
+  birth DateTime?
+  register String?
+  guides Guide[] // Relacionamento com as guias
+  createdAt DateTime @default(now())
+  updatedAt DateTime @updatedAt
+}
+
+model Patient {
+  id String          @id @default(uuid())
+  account Account @relation(fields: [accountId], references: [id]) // Relacionamento com a conta
+  accountId String // Relacionamento com a conta
+  name String
+  gender Gender? // Enum
+  birth DateTime?
+  guides Guide[] // Relacionamento com as guias
+  createdAt DateTime @default(now())
+  updatedAt DateTime @updatedAt
+}
+
+model Guide {
+  id String          @id @default(uuid())
+  account Account @relation(fields: [accountId], references: [id]) // Relacionamento com a conta
+  accountId String // Relacionamento com a conta
+  doctor Doctor @relation(fields: [doctorId], references: [id]) // Relacionamento com um Doctor
+  doctorId String // Relacionamento com um Doctor
+  patient Patient @relation(fields: [patientId], references: [id]) // Relacionamento com um Patient
+  patientId String // Relacionamento com um Patient
+  description String
+  createdAt DateTime @default(now())
+  updatedAt DateTime @updatedAt
+}
```


